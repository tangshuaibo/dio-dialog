var Dio=function(){function t(t){this.opt=Object.assign({modal:!1,overlay:!0,history:!0,closeOnEsc:!0,stackedButtons:!1,destroyOnClosed:!0},t),this.overlay=null,this.dialog=null,this.dialogTitle=null,this.dialogContent=null,this.dialogActions=null}return t.prototype={constructor:t,filterOpt:function(){["title","content"].forEach(function(t){"string"!=typeof this.opt[t]&&(this.opt[t]=null)},this),["overlay","history","closeOnEsc","destroyOnClosed"].forEach(function(t){"boolean"!=typeof this.opt[t]&&(this.opt[t]=!0)},this),["modal","stackedButtons"].forEach(function(t){"boolean"!=typeof this.opt[t]&&(this.opt[t]=!1)},this),Array.isArray(this.opt.buttons)&&this.opt.buttons.forEach(function(t){"string"!=typeof t.text&&(t.text=null),"boolean"!=typeof t.bold&&(t.bold=!1),"boolean"!=typeof t.close&&(t.close=!0),"function"!=typeof t.onClick&&(t.onClick=null)})},showDialog:function(){var t=this,e=this.opt;(function(){this.overlay.classList.add("show"),this.dialog.classList.add("show")}).call(this),function(){var i=function(){e.onOpen&&e.onOpen(),t.dialog.removeEventListener("animationstart",i)};this.dialog.addEventListener("animationstart",i),this.dialog.dispatchEvent(new Event("open")),this.dialog.state="open"}.call(this),function(){var i=function(){e.onOpened&&e.onOpened(),t.dialog.removeEventListener("animationend",i)};this.dialog.addEventListener("animationend",i),this.dialog.dispatchEvent(new Event("opened")),this.dialog.state="opened"}.call(this),function(){e.history&&this.watchHashChange()}.call(this)},hideDialog:function(){var t=this,e=this.opt;(function(){this.overlay.classList.add("hide"),this.dialog.classList.add("hide");var e=function(){t.overlay.classList.remove("show","hide"),t.overlay.removeEventListener("animationend",e)};this.overlay.addEventListener("animationend",e);var i=function(){t.dialog.classList.remove("show","hide"),t.dialog.removeEventListener("animationend",i)};this.dialog.addEventListener("animationend",i)}).call(this),function(){var i=function(){e.onClose&&e.onClose(),t.dialog.removeEventListener("animationstart",i)};this.dialog.addEventListener("animationstart",i),this.dialog.dispatchEvent(new Event("close")),this.dialog.state="close"}.call(this),function(){var i=function(){e.onClosed&&e.onClosed(),t.dialog.removeEventListener("animationend",i),e.destroyOnClosed&&(t.overlay.parentNode.removeChild(t.overlay),t.dialog.parentNode.removeChild(t.dialog),t.destroy())};this.dialog.addEventListener("animationend",i),this.dialog.dispatchEvent(new Event("closed")),this.dialog.state="closed"}.call(this),function(){e.history&&"back"!==arguments[0]&&history.back()}.call(this)},watchHashChange:function(){var t=this;location.hash&&"#dio-dialog"!==location.hash?location.hash+="?dio-dialog":location.hash||(location.hash="dio-dialog");var e=function(){location.hash.lastIndexOf("dio-dialog")<0&&("opened"===t.dialog.state&&t.hideDialog("back"),window.removeEventListener("hashchange",e))};window.addEventListener("hashchange",e)},modalDialog:function(){var t=this;this.opt.modal||this.overlay.addEventListener("click",function(e){this===e.target&&t.hideDialog()})},keyCodeEsc:function(){var t=this,e=this.opt;if(e.closeOnEsc){var i=function(n){27===n.keyCode&&t.hideDialog(),e.destroyOnClosed&&document.removeEventListener("keyup",i)};e.destroyOnClosed&&this.dialog.addEventListener("closed",function(){document.removeEventListener("keyup",i)}),document.addEventListener("keyup",i)}},render:function(){var t=this.opt,e=this;(function(){this.overlay=document.createElement("div"),this.overlay.classList.add("dio-overlay"),t.overlay||this.overlay.classList.add("invisible"),document.body.appendChild(this.overlay)}).call(this),function(){this.dialog=document.createElement("div"),this.dialog.classList.add("dio-dialog"),t.cssClass&&this.dialog.classList.add(t.cssClass),document.body.appendChild(this.dialog)}.call(this),function(){t.title&&(this.dialogTitle=document.createElement("div"),this.dialogTitle.classList.add("dio-dialog-title"),this.dialogTitle.innerHTML=t.title,this.dialog.appendChild(this.dialogTitle))}.call(this),function(){t.content&&(this.dialogContent=document.createElement("div"),this.dialogContent.classList.add("dio-dialog-content"),this.dialogContent.innerHTML=t.content,this.dialog.appendChild(this.dialogContent))}.call(this),function(){t.buttons&&t.buttons.length>0&&(this.dialogActions=document.createElement("div"),this.dialogActions.classList.add("dio-dialog-actions"),t.stackedButtons&&this.dialogActions.classList.add("stacked"),t.buttons.forEach(function(t){var i=Object.assign({text:"",bold:!1,close:!0,onClick:null},t);if(i.text){var n=document.createElement("span");n.classList.add("dio-dialog-btn"),n.innerHTML=i.text,e.dialogActions.appendChild(n),i.bold&&n.classList.add("bold"),i.close&&n.addEventListener("click",function(){e.hideDialog()}),i.onClick&&n.addEventListener("click",function(){i.onClick()})}}),this.dialog.appendChild(this.dialogActions))}.call(this)},init:function(){this.filterOpt(),this.render(),this.showDialog(),this.keyCodeEsc(),this.modalDialog()},destroy:function(){for(var t in this)delete this[t]}},t.dialog=function(e){var i=new t(e);return i.init(),i},t.alert=function(e){return(e=e||{}).confirmText&&"string"==typeof e.confirmText||(e.confirmText="确定"),t.dialog({title:e.title,content:e.text,buttons:[{text:e.confirmText,bold:!1,close:!0,onClick:e.onConfirm}],modal:e.modal,overlay:e.overlay,history:e.history,closeOnEsc:e.closeOnEsc})},t.confirm=function(e){return(e=e||{}).cancelText&&"string"==typeof e.cancelText||(e.cancelText="取消"),e.confirmText&&"string"==typeof e.confirmText||(e.confirmText="确定"),t.dialog({title:e.title,content:e.text,buttons:[{text:e.cancelText,bold:!1,close:!0,onClick:e.onCancel},{text:e.confirmText,bold:!1,close:!0,onClick:e.onConfirm}],modal:e.modal,overlay:e.overlay,history:e.history,closeOnEsc:e.closeOnEsc})},t.prompt=function(e){(e=e||{onCancel:function(){},onConfirm:function(){}}).cancelText&&"string"==typeof e.cancelText||(e.cancelText="取消"),e.confirmText&&"string"==typeof e.confirmText||(e.confirmText="确定");var i=new DioTextfield({type:e.type,label:e.label,maxlength:e.maxlength,placeholder:e.placeholder,defaultValue:e.defaultValue}).init(),n=t.dialog({buttons:[{text:e.cancelText,bold:!1,close:!0,onClick:function(){e.onCancel(i.getInput())}},{text:e.confirmText,bold:!1,close:!0,onClick:function(){e.onConfirm(i.getInput())}}],modal:e.modal,overlay:e.overlay,history:e.history,closeOnEsc:e.closeOnEsc});return n.dialogContent=document.createElement("div"),n.dialogContent.classList.add("dio-dialog-content"),n.dialogContent.appendChild(i.tf),n.dialog.insertBefore(n.dialogContent,n.dialogActions),"boolean"==typeof e.confirmOnEnter?e.confirmOnEnter&&i.tfInput.addEventListener("keyup",function(t){13===t.keyCode&&(i.setInput(i.getInput().replace(/\n/g,"")),n.dialogActions.querySelector(".dio-dialog-btn:last-of-type").dispatchEvent(new MouseEvent("click")))}):e.confirmOnEnter=!1,n},t}(),DioTextfield=function(){function t(t){this.opt=Object.assign({type:"text",label:null,maxlength:null,placeholder:null,defaultValue:null},t),this.tf=null,this.tfLabel=null,this.tfInput=null}return t.prototype={constructor:t,filterOpt:function(){"textarea"!==this.opt.type&&(this.opt.type="text"),"number"!=typeof this.opt.maxlength||this.opt.maxlength<0?this.opt.maxlength=null:this.opt.maxlength=Math.round(this.opt.maxlength),["label","placeholder","defaultValue"].forEach(function(t){"string"!=typeof this.opt[t]&&(this.opt[t]=null)},this)},create:function(){(function(){this.tf=document.createElement("div"),this.tf.classList.add("dio-textfield"),this.tf.addEventListener("click",function(t){this.classList.add("focus"),t.stopPropagation()});var t=this,e=function(){t&&t.tf?t.tf.classList.remove("focus"):document.removeEventListener("click",e)};document.addEventListener("click",e)}).call(this),function(){this.opt.label&&(this.tfLabel=document.createElement("label"),this.tfLabel.classList.add("dio-textfield-label"),this.tfLabel.innerHTML=this.opt.label,this.tf.appendChild(this.tfLabel))}.call(this),function(){if("text"===this.opt.type)this.tfInput=document.createElement("input"),this.opt.maxlength&&this.tfInput.setAttribute("maxlength",this.opt.maxlength),this.opt.placeholder&&this.tfInput.setAttribute("placeholder",this.opt.placeholder),this.opt.defaultValue&&this.tfInput.setAttribute("value",this.opt.defaultValue);else{this.tfInput=document.createElement("div"),this.tfInput.setAttribute("contenteditable",!0);var t=this;this.opt.maxlength&&this.tfInput.addEventListener("input",function(){if(this.innerText.length>t.opt.maxlength)if(window.getSelection){var e=getSelection(),i=e.anchorOffset,n=this.innerText.substr(0,t.opt.maxlength),o=n.substr(0,i),s=n.substr(i);e.selectAllChildren(this);var l=e.getRangeAt(0);l.deleteContents(),l.insertNode(document.createTextNode(s)),""===o?l.collapse(!1):(l.insertNode(document.createTextNode(o)),l.setStart(this,1),l.collapse(!0))}else this.innerText=this.innerText.substr(0,t.opt.maxlength)}),this.opt.placeholder&&this.tfInput.setAttribute("placeholder",this.opt.placeholder),this.opt.defaultValue&&(this.tfInput.innerText=this.opt.defaultValue)}this.tfInput.classList.add("dio-textfield-input"),this.tf.appendChild(this.tfInput)}.call(this)},render:function(t){t&&t.appendChild(this.tf)},getInput:function(){return"text"===this.opt.type?this.tfInput.value:this.tfInput.innerText},setInput:function(t){"text"===this.opt.type?this.tfInput.value=t:this.tfInput.innerText=t},init:function(t){return this.filterOpt(),this.create(),this.render(t),this},destroy:function(){for(var t in this)delete this[t]}},t}();